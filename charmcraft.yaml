# Copyright 2025 Canonical Ltd.
# See LICENSE file for licensing details.

type: charm
name: wireguard-gateway
title: WireGuard gateway
summary: WireGuard site-to-site VPN charm.
links:
  documentation: https://discourse.charmhub.io
  issues: https://github.com/canonical/wireguard-gateway-operator/issues
  source: https://github.com/canonical/wireguard-gateway-operator
  contact: https://launchpad.net/~canonical-is-devops

description: |
  The WireGuard gateway charm provides site-to-site VPN connections between 
  multiple networks.
  
  This charm simplifies the deployment of a highly available WireGuard VPN mesh,
  including WireGuard key exchange, OSPF-based routing configuration and 
  handling of link failures and failover, and VRRP-based virtual IPs for a
  high-performance, highly available, and secure site-to-site VPN solution.
  
  This charm makes operating a WireGuard site-to-site VPN straightforward for
  DevOps or SRE teams through Juju's clean interface. It allows deployment into
  multiple environments to test changes and supports scaling out for enterprise
  deployments.

base: ubuntu@24.04
platforms:
  amd64:

parts:
  charm:
    source: .
    plugin: uv
    build-snaps:
      - astral-uv
  dump:
    source: .
    plugin: dump
    stage:
      - templates
      - scripts

provides:
  wireguard-router-a:
    interface: wireguard_router

requires:
  wireguard-router-b:
    interface: wireguard_router

config:
  options:
    tunnels:
      type: int
      default: 2
      description: >-
        Maximum number of WireGuard tunnels to establish per remote unit. If a
        remote WireGuard gateway contains multiple units, this gateway will 
        create up to configured number of with each remote unit. If the two 
        peers are configured with different values, the effective tunnel count
        is the smaller of the two. Increasing this value may improve throughput
        on multi-core machines when it is CPU-bound.

    advertise-prefixes:
      type: string
      description: >-
        Comma-separated list of non-overlapping IPv4 and/or IPv6 prefixes to
        advertise to other integrated WireGuard gateways. These prefixes 
        represent the networks reachable from this gateway. Link-local 
        addresses and broadcast addresses must not be advertised.
        Example of this configuration: "10.0.0.0/24,2001:db8:100::/64"

    vips:
      type: string
      description: >-
        Comma-separated list of VRRP virtual IP addresses (VIPs) in CIDR notation.
        Each entry must include an IP address and prefix length.
        Example: "10.0.0.1/24,2001:db8::1/32"
