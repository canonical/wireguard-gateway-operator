# Copyright 2025 Canonical Ltd.
# See LICENSE file for licensing details.

type: charm
name: wireguard-gateway
title: Charm Template
summary: A very short one-line summary of the charm.
links:
  documentation: https://discourse.charmhub.io
  issues: https://github.com/canonical/platform-engineering-charm-template/issues
  source: https://github.com/canonical/platform-engineering-charm-template
  contact: https://launchpad.net/~canonical-is-devops

description: |
  A single sentence that says what the charm is, concisely and memorably.

  A paragraph of one to three short sentences, that describe what the charm does.

  A third paragraph that explains what need the charm meets.

  Finally, a paragraph that describes whom the charm is useful for.


base: ubuntu@24.04
platforms:
  amd64:

parts:
  charm:
    source: .
    plugin: uv
    build-snaps:
      - astral-uv
  dump:
    source: .
    plugin: dump
    stage:
      - templates
      - scripts

provides:
  wireguard-router-a:
    interface: wireguard_router

requires:
  wireguard-router-b:
    interface: wireguard_router

config:
  options:
    tunnels:
      type: int
      default: 2
      description: >-
        Maximum number of WireGuard tunnels to establish per remote unit. If a
        remote WireGuard gateway contains multiple units, this gateway will 
        create up to this many tunnels with each remote unit. If the two peers
        are configured with different values, the effective tunnel count is 
        the smaller of the two. Increasing this value may improve throughput on
        multi-core machines when it is CPU-bound.

    advertise-prefixes:
      type: string
      description: >-
        Comma-separated list of non-overlapping IPv4 and/or IPv6 prefixes to
        advertise to other integrated WireGuard gateways. These prefixes 
        represent the networks reachable from this gateway. Link-local 
        addresses and broadcast addresses must not be advertised.
        Example of this configuration: "10.0.0.0/24,2001:db8:100::/64"

    vips:
      type: string
      description: >-
        Comma-separated list of VRRP virtual IP addresses (VIPs) in CIDR notation.
        Each entry must include an IP address and prefix length.
        Example: "10.0.0.1/24,2001:db8::1/32"
